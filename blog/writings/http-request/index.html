<!doctype html><html data-n-head="lang" data-n-head-ssr lang="zh"><meta data-n-head="true" content="IE=edge,chrome=1" http-equiv='"X-UA-Compatible'><meta data-n-head="true" charset="utf-8"><meta data-n-head="true" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" name="viewport"><meta data-n-head="true" content="bowen blog, bowen 博客, vuejs, reactjs, ssr, 前端开发, 前端 , web开发, nodejs, github" name="keywords"><meta data-n-head="true" content="一个分享代码经历的地方" name="description" data-hid="description"><meta data-n-head="true" content="yes" name="apple-mobile-web-app-capable"><meta data-n-head="true" content="black" name="apple-mobile-web-app-status-bar-style"><meta data-n-head="true" content="yes" name="mobile-web-app-capable" data-hid="mobile-web-app-capable"><meta data-n-head="true" content="Bowen Blog" name="apple-mobile-web-app-title" data-hid="apple-mobile-web-app-title"><meta data-n-head="true" content="Bowen" name="author" data-hid="author"><meta data-n-head="true" content="#24292e" name="theme-color" data-hid="theme-color"><meta data-n-head="true" content="website" name="og:type" data-hid="og:type" property="og:type"><meta data-n-head="true" content="Bowen Blog" name="og:title" data-hid="og:title" property="og:title"><meta data-n-head="true" content="A place which is used to share programming experiences" name="og:description" data-hid="og:description" property="og:description"><title data-n-head="true">HTTP 协议请求首部 | Bowen Blog</title><link href="/favicon.ico" rel="icon" data-n-head="true" type="image/x-icon"><link href="/_nuxt/manifest.2108b1d4.json" rel="manifest" data-n-head="true"><link href="/_nuxt/icons/icon_64.e20A200w20w.png" rel="shortcut icon" data-n-head="true"><link href="/_nuxt/icons/icon_512.e20A200w20w.png" rel="apple-touch-icon" data-n-head="true" sizes="512x512"><link href="https://set.sh/blog/writings/http-request/" rel="alternate" data-n-head="true" hreflang="zh"><link href="/_nuxt/manifest.e871ed9ec943b3b0a9ad.js" rel="preload" as="script"><link href="/_nuxt/vendor.13de21511613edf061b2.js" rel="preload" as="script"><link href="/_nuxt/app.5a4fa6b8fcf73db97515.js" rel="preload" as="script"><link href="/_nuxt/app.7d838d8b0da655541c316320c8ad8e6f.css" rel="preload" as="style"><link href="/_nuxt/layouts/blog.6efcc6c813d476fa30a1.js" rel="preload" as="script"><link href="/_nuxt/pages/blog.48d3a2ec874d58a119ed.js" rel="preload" as="script"><link href="/_nuxt/pages/blog/writings/_id/index.7e8ea086028ccb843111.js" rel="preload" as="script"><link href="/_nuxt/pages/blog/tags/_id/index.edb9dbabb1b9c2ef81f2.js" rel="prefetch"><link href="/_nuxt/pages/index.1d0ac68e309be0e86168.js" rel="prefetch"><link href="/_nuxt/pages/blog/tags/index.2659d358b69abdfd34bf.js" rel="prefetch"><link href="/_nuxt/pages/blog/projects/index.3ff8e031c3cb4f25eaed.js" rel="prefetch"><link href="/_nuxt/pages/blog/writings/index.b016af22016e152b7231.js" rel="prefetch"><link href="/_nuxt/layouts/home.dd55e95df1c2109ebde6.js" rel="prefetch"><link href="/_nuxt/layouts/default.89ffa224d3d7769e4fbb.js" rel="prefetch"><link href="/_nuxt/app.7d838d8b0da655541c316320c8ad8e6f.css" rel="stylesheet"><body data-n-head=""><div id="__nuxt" data-server-rendered="true"><div class="nuxt-progress" style="width:0%;height:2px;background-color:#3eaf7c;opacity:0"></div><div id="__layout"><section class="blog sf__parent__clearfix" data-v-cac63c14><header class="header __position components-animation" data-v-13c46026 data-v-cac63c14><nav class="mobile-navigator" data-v-13c46026 data-v-d4cae7a6><label class="label-line" data-v-d4cae7a6><span class="__position label-line line-top" data-v-d4cae7a6><span class="__position line-crust line-crust-top" data-v-d4cae7a6></span></span><span class="__position label-line line-bottom" data-v-d4cae7a6><span class="__position line-crust line-crust-bottom" data-v-d4cae7a6></span></span></label></nav><nav class="navigator __position grid" data-v-13c46026 role="navigation"><a href="/" class="navigator-link hover-animation grid-cell" data-v-13c46026>HOME</a><a href="/blog/writings/" class="navigator-link hover-animation grid-cell" data-v-13c46026>WRITINGS</a><a href="/blog/projects/" class="navigator-link hover-animation grid-cell" data-v-13c46026>PROJECTS</a><a href="/blog/tags/" class="navigator-link hover-animation grid-cell" data-v-13c46026>TAGS</a><a href="https://github.com/lbwa" class="navigator-link hover-animation grid-cell" data-v-13c46026 rel="noopener" target="_blank">GITHUB</a></nav><div class="background-helper __position" data-v-13c46026></div></header><main class="articles-container wrapper sf__reference__layout" data-v-cac63c14 role="main"><article class="articles-main"><div class="article-header"><h1 class="article-title">HTTP 协议请求首部</h1><span class="article-author">Bowen</span><span class="article-date">2018 JUN 08</span><div class="article-tags"><a href="/blog/tags/前端开发" class="article-tag">前端开发</a><a href="/blog/tags/网络请求" class="article-tag">网络请求</a></div></div><div class="article-content"><p><code>HTTP</code> 请求首部 <em><strong>不具有强约束</strong></em>。它将与 <code>server</code> 端进行内容协商（<a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Content_negotiation" rel="noopener noreferrer" target="_blank">source<outboundlink></a>），<code>server</code> 端将依托与请求首部对应的响应首部返回对应的内容协商结果。即可能不执行请求首部的请求值，而在对应的响应头中返回其他值。<h2 id="cookie"><a href="#cookie" class="header-anchor" aria-hidden="true">#</a> Cookie</h2><ul><li>通过 <code>server</code> 端响应首部 <code>Set-Cookie</code> 设置本地 <code>HTTP Cookie</code>。在每次请求时，会通过 <code>Cookie</code> 请求首部携带 <code>HTTP Cookie</code>（[extension][extension-cookie]）传输至 <code>server</code> 端验证，用于确认当前用户等同源信息。</ul><p>在 <code>client</code> 发起一个 <code>HTTP</code> 请求时，最多只能有一个 <code>Cookie</code> 头部被建立，但 <code>HTTP Cookie</code> 不具有唯一性，可以有多个。当 <code>client</code> 设置禁用 <code>Cookie</code> 后，请求时将完全忽略 <code>Cookie</code> 首部的建立。<p>（拓展阅读: <code>HTTP 响应首部</code> - <a href="/blog/writings/http-response/#set-cookie">Set-Cookie</a>）<h2 id="connection-长连接"><a href="#connection-长连接" class="header-anchor" aria-hidden="true">#</a> Connection/长连接</h2><ul><li><p>值为 <code>keep-alive</code> 或 <code>close</code>。<li><p>用于构建 <code>HTTP</code> 长连接，复用同一客户端下的 <code>TCP</code> 通道。即用于告知 <code>server</code> 端在此次请求完成后，是否应该保持 <code>TCP</code> 通道开启，以用于该 <code>client</code> 下次请求可跳过 <code>三次握手</code> 直接进行 <code>TCP</code> 传输。<ul><li><p>注：此举不具有强约束，那么 <code>server</code> 端 <em><strong>可能</strong></em> 有自己的实现并返回不同值的 <code>Connection</code> 响应头，而不遵循 <code>Connection</code> 请求头的值。<li><p>在建立 <code>HTTP</code> 长连接后，若没有新的请求，在有效期后 <code>server</code> 将会关闭当前 <code>TCP</code> 连接通道。</ul></ul><h3 id="资源请求与加载"><a href="#资源请求与加载" class="header-anchor" aria-hidden="true">#</a> 资源请求与加载</h3><p>（拓展阅读: <a href="https://www.html5rocks.com/en/tutorials/internals/howbrowserswork/" rel="noopener noreferrer" target="_blank">浏览器工作原理<outboundlink></a>）<p>以 <code>Chrome</code> 为示例，在控制台 <code>Network</code> 选项卡的 <code>Connection ID</code> （原理介绍<a href="https://stackoverflow.com/questions/34184994/chrome-developer-tools-connection-id" rel="noopener noreferrer" target="_blank">source<outboundlink></a>）条目中，相同 ID 的连接即是使用的同一 <code>TCP</code> 通道。<p>（更多的 <code>Chrome</code> 的 1. <code>waterfall</code> 文档：<a href="https://developers.google.com/web/tools/chrome-devtools/network-performance/understanding-resource-timing" rel="noopener noreferrer" target="_blank">source<outboundlink></a>。2. 控制台官方文档（<a href="https://developers.google.com/web/tools/chrome-devtools/" rel="noopener noreferrer" target="_blank">source<outboundlink></a>））<ol><li><p>在 <code>HTTP 1.1</code> 中 <code>TCP</code> 通道本身是串行请求的，即一个 <code>TCP</code> 通道内每次只执行一次请求，但该 <code>TCP</code> 连接通道是可以被同一 <code>client</code> 的不同请求复用的（此处应与浏览器允许多个 <code>TCP</code> 并发进行区分）。<ul><li>在 <code>HTTP 2</code> 中可进行并发请求。即在请求时，所有请求可并发复用同一个 <code>TCP</code> 通道。</ul><li><p><code>client</code> 在请求 <em><strong>同域</strong></em> 的情况下会尽量复用同一 <code>TCP</code> 通道。超出限定时间后未有新的请求时，<code>server</code> 会关闭当前 <code>TCP</code> 连接通道。<li><p><code>Chrome</code> 现阶段最大并发数为 6，那么即最多有 6 个 <code>TCP</code> 请求（通道开启）同时进行，超出的请求将在队列中等待（<a href="https://developers.google.com/web/tools/chrome-devtools/network-performance/understanding-resource-timing" rel="noopener noreferrer" target="_blank">source<outboundlink></a>）。</ol><p>整体加载时，<code>waterfall</code> 图例：<p>（注：以下浏览器默认添加 <code>Connection: keep-alive</code> 请求头。）<p><img alt="waterfall1" src="https://assets.set.sh/2018/180608-http-request/waterfall-integrity1.png"><p>上图中，首先加载 <code>HTML</code> 文件，在 DOM 树构建完成后，加载外部资源，那么表现为前六个外部资源 <code>TCP</code> 请求是并发的，所以他们之间的 <code>Connection ID</code> 是不同的。<p>当其中某一外部资源加载完成，那么请求队列中的请求开始复用之前的 <code>TCP</code> 通道，这点可从后续请求的 <code>Connection ID</code> 可以看到。<p><img alt="waterfall2" src="https://assets.set.sh/2018/180608-http-request/waterfall-integrity2.png"><p>单个外部资源 <code>waterfall</code> 详细对比：<p><img alt="initial" src="https://assets.set.sh/2018/180608-http-request/waterfall-initial.png"><p>上图中经历过 <code>HTTP</code> 三次握手的初始化请求的 <code>waterfall</code> 中都有一栏桔黄色条目 <code>Initial connection</code>，表示 <code>三次握手</code> 所经历的时间。而经过复用 <code>TCP</code> 通道的请求时没有这一栏的，即不会经过 <code>三次握手</code>。<h2 id="accept-内容协商"><a href="#accept-内容协商" class="header-anchor" aria-hidden="true">#</a> Accept/内容协商</h2><p>与 <code>Content-Type</code> 响应首部对应。<p>表示 <code>client</code> 可处理的内容类型（<code>MIME</code>类型）。与 <code>Content-Type</code> 响应头对应。<p><code>MIME</code> 类型对应的文件拓展名：<a href="http://tool.oschina.net/commons" rel="noopener noreferrer" target="_blank">source<outboundlink></a><h2 id="content-type-客户端数据传输"><a href="#content-type-客户端数据传输" class="header-anchor" aria-hidden="true">#</a> Content-Type/客户端数据传输</h2><p>与响应首部中的 <code>Content-Type</code>（<a href="/blog/writings/http-response/#content-type-%E5%86%85%E5%AE%B9%E5%8D%8F%E5%95%86">source</a>）进行区分。请求首部的 <code>Content-Type</code> 表示传输给 <code>server</code> 端的数据内容的 <code>MIME</code> 类型，该请求首部可用于提交 <code>Form</code> 表单的 <code>POST</code> 请求中。<h3 id="通过标签的默认行为提交"><a href="#通过标签的默认行为提交" class="header-anchor" aria-hidden="true">#</a> 通过标签的默认行为提交</h3><pre class="language-html" v-pre><code><span class="token comment">&lt;!-- enctype 默认只有三种类型，其他 MIME 类型可另使用 ajax 定义 --></span>
<span class="token comment">&lt;!-- 必须指定 method 否则浏览器默认执行 GET 方法，则数据会以查询参数传递，而不是数据内容 --></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>/target-url<span class="token punctuation">"</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>POST<span class="token punctuation">"</span></span> <span class="token attr-name">enctype</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>application/x-www-form-urlencoded<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>username<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span>
</code></pre><p><code>enctype</code> 的值选项：<ul><li><p><code>application/x-www-form-urlencoded</code>: 如果属性未指定时的默认值。<li><p><code>multipart/form-data</code>: 该值针对 <code>&lt;input type=file""></code> 元素。表现为拆分上传内容，上传内容（包含输入文本）将以 <em><strong>二进制</strong></em>（主要是因为上传文件必须以二进制传输） 传输至 <code>server</code> 端，而不是以字符串传输。<li><p><code>text/plain</code> (HTML5)</ul><p>注：在 <code>Chrome</code> 中，使用 <code>multipart/form-data</code> 时，不会在控制台 <code>network</code> 显示 <code>Request Payload</code>，除非使用 <code>Ajax</code> 提交表单。<h3 id="通过-ajax-提交"><a href="#通过-ajax-提交" class="header-anchor" aria-hidden="true">#</a> 通过 Ajax 提交</h3><pre class="language-html" v-pre><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>/target-url<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>form<span class="token punctuation">"</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>POST<span class="token punctuation">"</span></span> <span class="token attr-name">enctype</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>multipart/form-data<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>username<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>file<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>file<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>file-functions<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">
  <span class="token keyword">const</span> form <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'form'</span><span class="token punctuation">)</span>
  form<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'submit'</span><span class="token punctuation">,</span> evt <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token comment">// 阻止标签的默认提交，即标签中的 method 提交</span>
    evt<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> formData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FormData</span><span class="token punctuation">(</span>form<span class="token punctuation">)</span>

    <span class="token comment">// fetch API 可根据 form 信息自动添加 Content-Type 请求头，不用主动声明</span>
    <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'/target-url'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      method<span class="token punctuation">:</span> <span class="token string">'POST'</span><span class="token punctuation">,</span>
      body<span class="token punctuation">:</span> formData
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
</code></pre><h2 id="accept-encoding"><a href="#accept-encoding" class="header-anchor" aria-hidden="true">#</a> Accept-Encoding</h2><p>与 <code>Content-Encoding</code> 响应首部对应。<p>表示 <code>Client</code> 可接受的编码类型（通常是以某种压缩算法实现）。<code>client</code> 通过与 <code>server</code> 进行内容协商后，<code>server</code> 会通过 <code>Content-Encoding</code> 响应头的方式告知 <code>client</code> 端 <code>server</code> 端最终所选择的编码方式。<h3 id="值"><a href="#值" class="header-anchor" aria-hidden="true">#</a> 值</h3><p><code>gzip</code> 表示采用 <code>Lempel-Ziv coding (LZ77)</code> 压缩算法，以及32位CRC校验的编码方式。<p><code>compress</code> 采用 <code>Lempel-Ziv-Welch (LZW)</code> 压缩算法，已被大部分浏览器弃用。<p><code>deflate</code> 采用 <code>zlib</code> 结构和 <code>deflate</code> 压缩算法。<p><code>br</code> 表示采用 <code>Brotli</code> 算法的编码方式。<p><code>identity</code> 用于指代自身，如未经过压缩或修改。<p><code>*</code> 匹配任意未在请求首部中列出的编码方式。<p><code>;q=</code> 表示 <em><strong>权重</strong></em>，即编码方式的优先顺序。<h2 id="accept-language"><a href="#accept-language" class="header-anchor" aria-hidden="true">#</a> Accept-Language</h2><p>与 <code>Content-Language</code> 响应首部对应。<p>表示 <code>client</code> 端所能理解的自然语言，如中文、en。<h2 id="user-agent"><a href="#user-agent" class="header-anchor" aria-hidden="true">#</a> User-Agent</h2><p>表示当前 <code>client</code> 端的信息。即 <code>navigator.userAgent</code> 的值。</div></article><button data-v-e85d20b2 data-v-e85d20b2 class="floating-btn __position" style="display:none"><svg class="icon-rocket" data-v-e85d20b2 viewBox="0 0 512 512"><path d="M256 421.6c-18.1 0-33.2-6.8-42.9-10.9-5.4-2.3-11.3 1.8-10.9 7.6l3.5 51c.2 3.1 3.8 4.7 6.3 2.8l14.5-11c1.8-1.4 4.5-.9 5.7 1l20.5 32.1c1.5 2.4 5.1 2.4 6.6 0l20.5-32.1c1.2-1.9 3.9-2.4 5.7-1l14.5 11c2.5 1.9 6.1.3 6.3-2.8l3.5-51c.4-5.8-5.5-10-10.9-7.6-9.8 4.1-24.8 10.9-42.9 10.9z" data-v-e85d20b2></path><path d="M397.7 293.1l-48-49.1c0-158-93.2-228-93.2-228s-94.1 70-94.1 228l-48 49.1c-1.8 1.8-2.6 4.5-2.2 7.1L130.6 412c.9 5.7 7.1 8.5 11.8 5.4l67.1-45.4s20.7 20 47.1 20c26.4 0 46.1-20 46.1-20l67.1 45.4c4.6 3.1 10.8.3 11.8-5.4l18.5-111.9c.2-2.6-.6-5.2-2.4-7zM256.5 192c-17 0-30.7-14.3-30.7-32s13.8-32 30.7-32c17 0 30.7 14.3 30.7 32s-13.7 32-30.7 32z" data-v-e85d20b2></path></svg></button></main><footer class="blog-footer sf__main__layout grid col grid-jc-center" data-v-1044ad0a data-v-cac63c14><div class="footer-info" data-v-1044ad0a>Copyright © 2018 <a href="https://github.com/lbwa" class="author" rel="noopener" target="_blank" data-v-1044ad0a>Bowen</a></div></footer><section class="loading-wrapper grid col grid-center grid-jc-center" data-v-cac63c14 style="display:none"><div class="loading"><div class="loading-item"></div><div class="loading-item"></div><div class="loading-item"></div><div class="loading-item"></div><div class="loading-item"></div></div><a class="loading-tips">Loading</a></section></section></div></div><script type="text/javascript">window.__NUXT__={layout:"blog",data:[{menu:[{errno:0,to:"writings/dom-location",title:"获取 Element 在 document 中的位置信息",author:"Bowen",date:"2018 SEP 01",tags:["前端开发","CSS"]},{errno:0,to:"writings/spa-and-mpa",title:"SPA 与 MPA 的比较与优化",author:"Bowen",date:"2018 AUG 04",tags:["前端开发","SPA","MPA","skeleton"]},{errno:0,to:"writings/async-function-in-js",title:"Event loops 中的 AsyncFunction",author:"Bowen",date:"2018 JUL 26",tags:["JavaScript","async","事件循环"]},{errno:0,to:"writings/pwa-fundamentals",title:"PWA 基础",author:"Bowen",date:"2018 JUL 07",tags:["前端开发","PWA"]},{errno:0,to:"writings/js-design-pattern",title:"JS 设计模式",author:"Bowen",date:"2018 JUN 12",tags:["前端开发","设计模式"]},{errno:0,to:"writings/http-request",title:"HTTP 协议请求首部",author:"Bowen",date:"2018 JUN 08",tags:["前端开发","网络请求"]},{errno:0,to:"writings/http-response",title:"HTTP 协议响应首部",author:"Bowen",date:"2018 JUN 07",tags:["前端开发","网络请求"]},{errno:0,to:"writings/http-protocol",title:"HTTP 协议",author:"Bowen",date:"2018 JUN 06",tags:["前端开发","网络请求"]},{errno:0,to:"writings/execution-context",title:"JS 执行上下文",author:"Bowen",date:"2018 MAY 07",tags:["前端开发","JavaScript","执行上下文"]},{errno:0,to:"writings/vue-lifecycle-and-slots",title:"对 Vue 插槽和生命周期的一点思考",author:"Bowen",date:"2018 APR 24",tags:["前端开发","Vue.js"]},{errno:0,to:"writings/learning-vue-unit-test",title:"总结如何进行单元测试",author:"Bowen",date:"2018 APR 21",tags:["前端开发","Vue.js","应用测试"]},{errno:0,to:"writings/cross-domain-solution",title:"客户端跨域解决方案",author:"Bowen",date:"2018 APR 19",tags:["前端开发","网络请求"]},{errno:0,to:"writings/css-bfc",title:"探究 BFC 以及闭合浮动原理",author:"Bowen",date:"2018 MAR 29",tags:["前端开发","CSS"]},{errno:0,to:"writings/vue.js-reusability-and-composition",title:"学习 Vue.js 可复用性和组合",author:"Bowen",date:"2018 MAR 12",tags:["前端开发","JavaScript","Vue.js"]},{errno:0,to:"writings/event-loop",title:"解析 event loops",author:"Bowen",date:"2018 MAR 08",tags:["前端开发","JavaScript","事件循环"]},{errno:0,to:"writings/learning-vuex",title:"学习 vuex 基础",author:"Bowen",date:"2018 MAR 06",tags:["前端开发","Vue.js"]},{errno:0,to:"writings/compare-commonjs-with-esm",title:"比较 CommonJS 与 ES6 Module 语法",author:"Bowen",date:"2018 FEB 27",tags:["前端开发","JavaScript","模块"]},{errno:0,to:"writings/learning-vuejs-essentials",title:"学习 Vue.js 基础",author:"Bowen",date:"2018 FEB 24",tags:["前端开发","JavaScript","Vue.js"]},{errno:0,to:"writings/keyword-this",title:"理解 this 的指向",author:"Bowen",date:"2018 FEB 06",tags:["前端开发","JavaScript"]}]},{title:"HTTP 协议请求首部",date:"2018 JUN 08",author:"Bowen",tags:["前端开发","网络请求"],content:'<p><code>HTTP</code> 请求首部 <em><strong>不具有强约束</strong></em>。它将与 <code>server</code> 端进行内容协商（<a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Content_negotiation" target="_blank" rel="noopener noreferrer">source<OutboundLink/></a>），<code>server</code> 端将依托与请求首部对应的响应首部返回对应的内容协商结果。即可能不执行请求首部的请求值，而在对应的响应头中返回其他值。</p>\n<h2 id="cookie"><a class="header-anchor" href="#cookie" aria-hidden="true">#</a> Cookie</h2>\n<ul>\n<li>通过 <code>server</code> 端响应首部 <code>Set-Cookie</code> 设置本地 <code>HTTP Cookie</code>。在每次请求时，会通过 <code>Cookie</code> 请求首部携带 <code>HTTP Cookie</code>（[extension][extension-cookie]）传输至 <code>server</code> 端验证，用于确认当前用户等同源信息。</li>\n</ul>\n<p>在 <code>client</code> 发起一个 <code>HTTP</code> 请求时，最多只能有一个 <code>Cookie</code> 头部被建立，但 <code>HTTP Cookie</code> 不具有唯一性，可以有多个。当 <code>client</code> 设置禁用 <code>Cookie</code> 后，请求时将完全忽略 <code>Cookie</code> 首部的建立。</p>\n<p>（拓展阅读: <code>HTTP 响应首部</code> - <a href="/blog/writings/http-response/#set-cookie">Set-Cookie</a>）</p>\n<h2 id="connection-长连接"><a class="header-anchor" href="#connection-长连接" aria-hidden="true">#</a> Connection/长连接</h2>\n<ul>\n<li>\n<p>值为 <code>keep-alive</code> 或 <code>close</code>。</p>\n</li>\n<li>\n<p>用于构建 <code>HTTP</code> 长连接，复用同一客户端下的 <code>TCP</code> 通道。即用于告知 <code>server</code> 端在此次请求完成后，是否应该保持 <code>TCP</code> 通道开启，以用于该 <code>client</code> 下次请求可跳过 <code>三次握手</code> 直接进行 <code>TCP</code> 传输。</p>\n<ul>\n<li>\n<p>注：此举不具有强约束，那么 <code>server</code> 端 <em><strong>可能</strong></em> 有自己的实现并返回不同值的 <code>Connection</code> 响应头，而不遵循 <code>Connection</code> 请求头的值。</p>\n</li>\n<li>\n<p>在建立 <code>HTTP</code> 长连接后，若没有新的请求，在有效期后 <code>server</code> 将会关闭当前 <code>TCP</code> 连接通道。</p>\n</li>\n</ul>\n</li>\n</ul>\n<h3 id="资源请求与加载"><a class="header-anchor" href="#资源请求与加载" aria-hidden="true">#</a> 资源请求与加载</h3>\n<p>（拓展阅读: <a href="https://www.html5rocks.com/en/tutorials/internals/howbrowserswork/" target="_blank" rel="noopener noreferrer">浏览器工作原理<OutboundLink/></a>）</p>\n<p>以 <code>Chrome</code> 为示例，在控制台 <code>Network</code> 选项卡的 <code>Connection ID</code> （原理介绍<a href="https://stackoverflow.com/questions/34184994/chrome-developer-tools-connection-id" target="_blank" rel="noopener noreferrer">source<OutboundLink/></a>）条目中，相同 ID 的连接即是使用的同一 <code>TCP</code> 通道。</p>\n<p>（更多的 <code>Chrome</code> 的 1. <code>waterfall</code> 文档：<a href="https://developers.google.com/web/tools/chrome-devtools/network-performance/understanding-resource-timing" target="_blank" rel="noopener noreferrer">source<OutboundLink/></a>。2. 控制台官方文档（<a href="https://developers.google.com/web/tools/chrome-devtools/" target="_blank" rel="noopener noreferrer">source<OutboundLink/></a>））</p>\n<ol>\n<li>\n<p>在 <code>HTTP 1.1</code> 中 <code>TCP</code> 通道本身是串行请求的，即一个 <code>TCP</code> 通道内每次只执行一次请求，但该 <code>TCP</code> 连接通道是可以被同一 <code>client</code> 的不同请求复用的（此处应与浏览器允许多个 <code>TCP</code> 并发进行区分）。</p>\n<ul>\n<li>在 <code>HTTP 2</code> 中可进行并发请求。即在请求时，所有请求可并发复用同一个 <code>TCP</code> 通道。</li>\n</ul>\n</li>\n<li>\n<p><code>client</code> 在请求 <em><strong>同域</strong></em> 的情况下会尽量复用同一 <code>TCP</code> 通道。超出限定时间后未有新的请求时，<code>server</code> 会关闭当前 <code>TCP</code> 连接通道。</p>\n</li>\n<li>\n<p><code>Chrome</code> 现阶段最大并发数为 6，那么即最多有 6 个 <code>TCP</code> 请求（通道开启）同时进行，超出的请求将在队列中等待（<a href="https://developers.google.com/web/tools/chrome-devtools/network-performance/understanding-resource-timing" target="_blank" rel="noopener noreferrer">source<OutboundLink/></a>）。</p>\n</li>\n</ol>\n<p>整体加载时，<code>waterfall</code> 图例：</p>\n<p>（注：以下浏览器默认添加 <code>Connection: keep-alive</code> 请求头。）</p>\n<p><img src="https://assets.set.sh/2018/180608-http-request/waterfall-integrity1.png" alt="waterfall1"></p>\n<p>上图中，首先加载 <code>HTML</code> 文件，在 DOM 树构建完成后，加载外部资源，那么表现为前六个外部资源 <code>TCP</code> 请求是并发的，所以他们之间的 <code>Connection ID</code> 是不同的。</p>\n<p>当其中某一外部资源加载完成，那么请求队列中的请求开始复用之前的 <code>TCP</code> 通道，这点可从后续请求的 <code>Connection ID</code> 可以看到。</p>\n<p><img src="https://assets.set.sh/2018/180608-http-request/waterfall-integrity2.png" alt="waterfall2"></p>\n<p>单个外部资源 <code>waterfall</code> 详细对比：</p>\n<p><img src="https://assets.set.sh/2018/180608-http-request/waterfall-initial.png" alt="initial"></p>\n<p>上图中经历过 <code>HTTP</code> 三次握手的初始化请求的 <code>waterfall</code> 中都有一栏桔黄色条目 <code>Initial connection</code>，表示 <code>三次握手</code> 所经历的时间。而经过复用 <code>TCP</code> 通道的请求时没有这一栏的，即不会经过 <code>三次握手</code>。</p>\n<h2 id="accept-内容协商"><a class="header-anchor" href="#accept-内容协商" aria-hidden="true">#</a> Accept/内容协商</h2>\n<p>与 <code>Content-Type</code> 响应首部对应。</p>\n<p>表示 <code>client</code> 可处理的内容类型（<code>MIME</code>类型）。与 <code>Content-Type</code> 响应头对应。</p>\n<p><code>MIME</code> 类型对应的文件拓展名：<a href="http://tool.oschina.net/commons" target="_blank" rel="noopener noreferrer">source<OutboundLink/></a></p>\n<h2 id="content-type-客户端数据传输"><a class="header-anchor" href="#content-type-客户端数据传输" aria-hidden="true">#</a> Content-Type/客户端数据传输</h2>\n<p>与响应首部中的 <code>Content-Type</code>（<a href="/blog/writings/http-response/#content-type-%E5%86%85%E5%AE%B9%E5%8D%8F%E5%95%86">source</a>）进行区分。请求首部的 <code>Content-Type</code> 表示传输给 <code>server</code> 端的数据内容的 <code>MIME</code> 类型，该请求首部可用于提交 <code>Form</code> 表单的 <code>POST</code> 请求中。</p>\n<h3 id="通过标签的默认行为提交"><a class="header-anchor" href="#通过标签的默认行为提交" aria-hidden="true">#</a> 通过标签的默认行为提交</h3>\n<pre v-pre class="language-html"><code><span class="token comment">&lt;!-- enctype 默认只有三种类型，其他 MIME 类型可另使用 ajax 定义 --\x3e</span>\n<span class="token comment">&lt;!-- 必须指定 method 否则浏览器默认执行 GET 方法，则数据会以查询参数传递，而不是数据内容 --\x3e</span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>/target-url<span class="token punctuation">"</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>POST<span class="token punctuation">"</span></span> <span class="token attr-name">enctype</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>application/x-www-form-urlencoded<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>username<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span>\n</code></pre>\n<p><code>enctype</code> 的值选项：</p>\n<ul>\n<li>\n<p><code>application/x-www-form-urlencoded</code>: 如果属性未指定时的默认值。</p>\n</li>\n<li>\n<p><code>multipart/form-data</code>: 该值针对 <code>&lt;input type=file&quot;&quot;&gt;</code> 元素。表现为拆分上传内容，上传内容（包含输入文本）将以 <em><strong>二进制</strong></em>（主要是因为上传文件必须以二进制传输） 传输至 <code>server</code> 端，而不是以字符串传输。</p>\n</li>\n<li>\n<p><code>text/plain</code> (HTML5)</p>\n</li>\n</ul>\n<p>注：在 <code>Chrome</code> 中，使用 <code>multipart/form-data</code> 时，不会在控制台 <code>network</code> 显示 <code>Request Payload</code>，除非使用 <code>Ajax</code> 提交表单。</p>\n<h3 id="通过-ajax-提交"><a class="header-anchor" href="#通过-ajax-提交" aria-hidden="true">#</a> 通过 Ajax 提交</h3>\n<pre v-pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>/target-url<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>form<span class="token punctuation">"</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>POST<span class="token punctuation">"</span></span> <span class="token attr-name">enctype</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>multipart/form-data<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>username<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>file<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>file<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>file-functions<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span>\n\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript">\n  <span class="token keyword">const</span> form <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">\'form\'</span><span class="token punctuation">)</span>\n  form<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">\'submit\'</span><span class="token punctuation">,</span> evt <span class="token operator">=></span> <span class="token punctuation">{</span>\n    <span class="token comment">// 阻止标签的默认提交，即标签中的 method 提交</span>\n    evt<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n    <span class="token keyword">const</span> formData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FormData</span><span class="token punctuation">(</span>form<span class="token punctuation">)</span>\n\n    <span class="token comment">// fetch API 可根据 form 信息自动添加 Content-Type 请求头，不用主动声明</span>\n    <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">\'/target-url\'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>\n      method<span class="token punctuation">:</span> <span class="token string">\'POST\'</span><span class="token punctuation">,</span>\n      body<span class="token punctuation">:</span> formData\n    <span class="token punctuation">}</span><span class="token punctuation">)</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span>\n</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n</code></pre>\n<h2 id="accept-encoding"><a class="header-anchor" href="#accept-encoding" aria-hidden="true">#</a> Accept-Encoding</h2>\n<p>与 <code>Content-Encoding</code> 响应首部对应。</p>\n<p>表示 <code>Client</code> 可接受的编码类型（通常是以某种压缩算法实现）。<code>client</code> 通过与 <code>server</code> 进行内容协商后，<code>server</code> 会通过 <code>Content-Encoding</code> 响应头的方式告知 <code>client</code> 端 <code>server</code> 端最终所选择的编码方式。</p>\n<h3 id="值"><a class="header-anchor" href="#值" aria-hidden="true">#</a> 值</h3>\n<p><code>gzip</code> 表示采用 <code>Lempel-Ziv coding (LZ77)</code> 压缩算法，以及32位CRC校验的编码方式。</p>\n<p><code>compress</code> 采用 <code>Lempel-Ziv-Welch (LZW)</code> 压缩算法，已被大部分浏览器弃用。</p>\n<p><code>deflate</code> 采用 <code>zlib</code> 结构和 <code>deflate</code> 压缩算法。</p>\n<p><code>br</code> 表示采用 <code>Brotli</code> 算法的编码方式。</p>\n<p><code>identity</code> 用于指代自身，如未经过压缩或修改。</p>\n<p><code>*</code> 匹配任意未在请求首部中列出的编码方式。</p>\n<p><code>;q=</code> 表示 <em><strong>权重</strong></em>，即编码方式的优先顺序。</p>\n<h2 id="accept-language"><a class="header-anchor" href="#accept-language" aria-hidden="true">#</a> Accept-Language</h2>\n<p>与 <code>Content-Language</code> 响应首部对应。</p>\n<p>表示 <code>client</code> 端所能理解的自然语言，如中文、en。</p>\n<h2 id="user-agent"><a class="header-anchor" href="#user-agent" aria-hidden="true">#</a> User-Agent</h2>\n<p>表示当前 <code>client</code> 端的信息。即 <code>navigator.userAgent</code> 的值。</p>\n'}],error:null,serverRendered:!0}</script><script defer src="/_nuxt/manifest.e871ed9ec943b3b0a9ad.js"></script><script defer src="/_nuxt/layouts/blog.6efcc6c813d476fa30a1.js"></script><script defer src="/_nuxt/pages/blog.48d3a2ec874d58a119ed.js"></script><script defer src="/_nuxt/pages/blog/writings/_id/index.7e8ea086028ccb843111.js"></script><script defer src="/_nuxt/vendor.13de21511613edf061b2.js"></script><script defer src="/_nuxt/app.5a4fa6b8fcf73db97515.js"></script>